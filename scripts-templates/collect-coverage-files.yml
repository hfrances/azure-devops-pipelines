steps:
  - task: PowerShell@2
    inputs:
      pwsh: true
      targetType: 'inline'
      script: |
        $path = @("**/*.[Cc]obertura.xml", "**/[Cc]obertura.xml", "*.[Cc]obertura.xml", "[Cc]obertura.xml");
        $files = @();
        $coverageResults = "";
        Get-Item $path;
        Get-Item $path | `
          Group-Object Directory | `
          ForEach-Object {
            $files += ($_.Group | Sort-Object LastWriteTime | Select-Object -First 1)
          };
        
        Write-Output "`nCollected coverage files:"
        $files.FullName;
        $files | ForEach-Object {
          if ($coverageResults -ne "") {
            $coverageResults +=";";
          }
          $coverageResults += $_.FullName;
          Copy-Item $_ $(Agent.TempDirectory); 
        }
        write-output "##vso[task.setvariable variable=CoverageResults]$coverageResults"
    condition: eq(variables.HasTests, 'true')
    displayName: 'Coverage: Collect files'